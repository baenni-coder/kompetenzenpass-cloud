<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digitaler Kompetenzpass - Cloud Version</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“</text></svg>">
    <!-- Firebase SDK v9 -->
    <script type="module">
        // Firebase Konfiguration - ERSETZE DIESE WERTE MIT DEINEN EIGENEN!
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getStorage } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';

        const firebaseConfig = {
  apiKey: "AIzaSyBfXZSQ5SPrJ-cNRRuggTSiTV_UBt14g9s",
  authDomain: "kompetenzpass.firebaseapp.com",
  projectId: "kompetenzpass",
  storageBucket: "kompetenzpass.firebasestorage.app",
  messagingSenderId: "46794299225",
  appId: "1:46794299225:web:fa145209709de27adb9e48",
  measurementId: "G-YNSXPTK0PH"
};

        // Firebase initialisieren
        const app = initializeApp(firebaseConfig);
        window.auth = getAuth(app);
        window.db = getFirestore(app);
        window.storage = getStorage(app);

        // Firebase global verfÃ¼gbar machen
        window.firebaseApp = app;
    </script>
    
    <!-- jsPDF fÃ¼r PDF-Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- html2pdf.js fÃ¼r HTML zu PDF Konvertierung -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
    <div id="app">
        <!-- Lade-Anzeige -->
        <div id="loadingIndicator" class="loading-overlay hidden">
            <div class="spinner"></div>
            <p>Daten werden synchronisiert...</p>
        </div>

        <!-- Login-Bereich -->
        <div id="loginArea" class="container">
            <h1>ğŸ“ Digitaler Kompetenzpass</h1>
            <h2 style="text-align: center; color: #667eea;">â˜ï¸ Cloud Version</h2>
            
            <!-- SchÃ¼ler Login/Registrierung -->
            <div id="studentAuthBox" class="login-box">
                <h2>SchÃ¼ler-Bereich</h2>
                <div class="tab-buttons">
                    <button onclick="showStudentLogin()" id="loginTab" class="active">Anmelden</button>
                    <button onclick="showStudentRegister()" id="registerTab">Neu registrieren</button>
                </div>
                
                <!-- Login Form -->
                <div id="studentLoginForm">
                    <input type="email" id="studentEmail" placeholder="E-Mail Adresse">
                    <input type="password" id="studentPassword" placeholder="Passwort">
                    <button onclick="loginStudent()">Einloggen</button>
                </div>
                
                <!-- Register Form -->
                <div id="studentRegisterForm" class="hidden">
                    <input type="text" id="registerName" placeholder="Dein Name">
                    <input type="email" id="registerEmail" placeholder="E-Mail Adresse">
                    <input type="password" id="registerPassword" placeholder="Passwort (min. 6 Zeichen)">
                    <input type="text" id="registerClass" placeholder="Klasse (z.B. 7a)">
                    <button onclick="registerStudent()">Registrieren</button>
                </div>
                
                <div class="teacher-login-link">
                    <a href="#" onclick="showTeacherAuth(); return false;">ğŸ” Lehrer-Bereich</a>
                </div>
            </div>
            
            <!-- Lehrer Login -->
            <div id="teacherAuthBox" class="login-box hidden">
                <h2>Lehrer-Bereich</h2>
                <input type="email" id="teacherEmail" placeholder="E-Mail Adresse">
                <input type="password" id="teacherPassword" placeholder="Passwort">
                <button onclick="loginTeacher()">Als Lehrer einloggen</button>
                <div class="teacher-login-link">
                    <a href="#" onclick="showStudentAuth(); return false;">â† ZurÃ¼ck zum SchÃ¼ler-Login</a>
                </div>
                <p class="hint">Lehrer-Accounts werden vom Administrator erstellt</p>
            </div>
        </div>

        <!-- SchÃ¼ler-Bereich -->
        <div id="mainArea" class="container hidden">
            <header>
                <div class="header-top">
                    <h1>Mein Kompetenzpass</h1>
                    <span class="sync-status" id="syncStatus">âœ… Synchronisiert</span>
                </div>
                <p id="welcomeMessage"></p>
            </header>

            <!-- Badge Showcase -->
            <div id="badgeShowcase" class="badge-showcase">
                <!-- Badges werden hier eingefÃ¼gt -->
            </div>

            <div id="competencies">
                <!-- Kompetenzen werden hier eingefÃ¼gt -->
            </div>
            
            <div class="button-group">
                <button onclick="exportProgress()" class="primary">ğŸ“„ Als PDF exportieren</button>
                <button onclick="shareProgress()">ğŸ”— Fortschritt teilen</button>
                <button onclick="logoutUser()" class="secondary">Ausloggen</button>
            </div>
        </div>

        <!-- Lehrer-Dashboard -->
        <div id="teacherArea" class="container hidden">
            <header>
                <div class="header-top">
                    <h1>ğŸ“ Lehrer-Dashboard</h1>
                    <span class="sync-status">â˜ï¸ Cloud-Modus</span>
                </div>
                <p class="subtitle">Zentrale Verwaltung fÃ¼r alle Klassen</p>
            </header>

            <!-- Tab Navigation -->
            <div class="tab-navigation">
                <button class="tab-button active" onclick="switchTab('competencies-tab', event)">
                    ğŸ“š Kompetenzen
                </button>
                <button class="tab-button" onclick="switchTab('students-tab', event)">
                    ğŸ‘¥ SchÃ¼ler
                </button>
                <button class="tab-button" onclick="switchTab('classes-tab', event)">
                    ğŸ« Klassen
                </button>
                <button class="tab-button" onclick="switchTab('reviews-tab', event)" id="reviews-tab-button">
                    ğŸ“‹ AntrÃ¤ge <span id="reviewsBadge" class="review-count-badge hidden"></span>
                </button>
                <button class="tab-button" onclick="switchTab('badges-tab', event)">
                    ğŸ† Auszeichnungen
                </button>
                <button class="tab-button" onclick="switchTab('reports-tab', event)">
                    ğŸ“Š Berichte
                </button>
            </div>

            <!-- Tab: Kompetenzen -->
            <div id="competencies-tab" class="tab-content">
                <div class="action-bar">
                    <button onclick="addNewCompetency()" class="btn-add">
                        â• Neue Kompetenz
                    </button>
                    <button onclick="importCompetencies()" class="btn-import">
                        ğŸ“¥ Importieren
                    </button>
                    <button onclick="exportCompetencies()" class="btn-export">
                        ğŸ“¤ Exportieren
                    </button>
                </div>
                <div id="competencyList" class="competency-manager">
                    <!-- Kompetenzen werden hier geladen -->
                </div>
            </div>

            <!-- Tab: SchÃ¼ler -->
            <div id="students-tab" class="tab-content hidden">
                <div class="action-bar">
                    <button onclick="bulkCreateStudents()" class="btn-add">
                        â• Mehrere SchÃ¼ler anlegen
                    </button>
                </div>
                <div class="filter-bar">
                    <input type="text" id="studentSearch" placeholder="ğŸ” Suche..." onkeyup="filterStudents()">
                    <select id="classFilter" onchange="filterStudents()">
                        <option value="">Alle Klassen</option>
                    </select>
                    <button onclick="refreshStudentList()">ğŸ”„ Aktualisieren</button>
                </div>
                <div id="studentsList" class="students-grid">
                    <!-- Echtzeit-SchÃ¼lerdaten -->
                </div>
            </div>

            <!-- Tab: Klassen -->
            <div id="classes-tab" class="tab-content hidden">
                <div class="action-bar">
                    <button onclick="createClass()" class="btn-add">
                        â• Neue Klasse erstellen
                    </button>
                </div>
                <div id="classesList" class="classes-grid">
                    <!-- KlassenÃ¼bersicht -->
                </div>
            </div>

            <!-- Tab: AntrÃ¤ge (Reviews) -->
            <div id="reviews-tab" class="tab-content hidden">
                <div class="reviews-header">
                    <h3>ğŸ“‹ BewertungsantrÃ¤ge verwalten</h3>
                    <p class="subtitle">ÃœberprÃ¼fe und bestÃ¤tige Selbstbewertungen der SchÃ¼ler</p>
                </div>

                <!-- Filter Bar -->
                <div class="review-filter-bar">
                    <button class="review-filter-button active" onclick="loadReviewsWithFilter('pending')">
                        â³ Offen <span class="badge-count" id="pendingCount">0</span>
                    </button>
                    <button class="review-filter-button" onclick="loadReviewsWithFilter('approved')">
                        âœ… BestÃ¤tigt
                    </button>
                    <button class="review-filter-button" onclick="loadReviewsWithFilter('rejected')">
                        âŒ Abgelehnt
                    </button>
                    <button class="review-filter-button" onclick="loadReviewsWithFilter('all')">
                        ğŸ“‹ Alle
                    </button>
                </div>

                <!-- Reviews List -->
                <div id="reviewsList" class="review-list">
                    <!-- Reviews werden hier geladen -->
                </div>
            </div>

            <!-- Tab: Auszeichnungen -->
            <div id="badges-tab" class="tab-content hidden">
                <div class="badges-tab-header">
                    <h3>ğŸ† Badge-Verwaltung</h3>
                    <p class="subtitle">Verwalte Badges und verleihe Auszeichnungen an SchÃ¼ler</p>
                </div>

                <!-- Sub-Tabs -->
                <div class="sub-tab-navigation">
                    <button class="sub-tab-button active" onclick="switchBadgeSubTab('manage-badges')">
                        ğŸ“‹ Badge-Verwaltung
                    </button>
                    <button class="sub-tab-button" onclick="switchBadgeSubTab('award-badges')">
                        ğŸ Badges verleihen
                    </button>
                    <button class="sub-tab-button" onclick="switchBadgeSubTab('create-badge')">
                        âœ¨ Eigenes Badge erstellen
                    </button>
                </div>

                <!-- Sub-Tab: Badge-Verwaltung -->
                <div id="manage-badges" class="sub-tab-content">
                    <div class="badge-management-controls">
                        <h4>VerfÃ¼gbare Badges</h4>
                        <div class="badge-filter">
                            <select id="badgeTypeFilter" onchange="filterTeacherBadges()">
                                <option value="all">Alle Badges</option>
                                <option value="automatic">Automatische Badges</option>
                                <option value="teacher">Lehrer-Badges</option>
                            </select>
                        </div>
                    </div>
                    <div id="badgeManagementList" class="badge-management-list">
                        <!-- Badges werden hier geladen -->
                    </div>
                </div>

                <!-- Sub-Tab: Badges verleihen -->
                <div id="award-badges" class="sub-tab-content hidden">
                    <div class="award-badge-form">
                        <h4>Badge an SchÃ¼ler verleihen</h4>
                        <div class="form-group">
                            <label>SchÃ¼ler auswÃ¤hlen:</label>
                            <select id="awardBadgeStudent" class="form-control">
                                <option value="">SchÃ¼ler wÃ¤hlen...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Badge auswÃ¤hlen:</label>
                            <select id="awardBadgeType" class="form-control">
                                <option value="">Badge wÃ¤hlen...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>BegrÃ¼ndung (optional):</label>
                            <textarea id="awardBadgeReason" class="form-control" rows="3" placeholder="z.B. 'FÃ¼r herausragende Leistung im Projekt...'"></textarea>
                        </div>
                        <div class="form-actions">
                            <button onclick="executeAwardBadge()" class="btn-primary">ğŸ Badge verleihen</button>
                        </div>
                    </div>

                    <div class="recent-awards">
                        <h4>KÃ¼rzlich verliehene Badges</h4>
                        <div id="recentBadgeAwards" class="recent-awards-list">
                            <!-- KÃ¼rzlich verliehene Badges -->
                        </div>
                    </div>
                </div>

                <!-- Sub-Tab: Eigenes Badge erstellen -->
                <div id="create-badge" class="sub-tab-content hidden">
                    <div class="create-badge-form">
                        <h4>Neues Badge erstellen</h4>
                        <div class="form-group">
                            <label>Badge-Name:</label>
                            <input type="text" id="newBadgeName" class="form-control" placeholder="z.B. 'Kreativ-Preis'">
                        </div>
                        <div class="form-group">
                            <label>Beschreibung:</label>
                            <input type="text" id="newBadgeDescription" class="form-control" placeholder="z.B. 'FÃ¼r besonders kreative LÃ¶sungen'">
                        </div>
                        <div class="form-group">
                            <label>Emoji (Icon):</label>
                            <input type="text" id="newBadgeEmoji" class="form-control" placeholder="z.B. ğŸ¨" maxlength="2">
                            <small class="form-hint">Tipp: Kopiere ein Emoji von <a href="https://emojipedia.org" target="_blank">Emojipedia</a></small>
                        </div>
                        <div class="form-group">
                            <label>Seltenheit:</label>
                            <select id="newBadgeRarity" class="form-control">
                                <option value="common">ğŸŸ¢ HÃ¤ufig</option>
                                <option value="rare">ğŸ”µ Selten</option>
                                <option value="epic">ğŸŸ£ Episch</option>
                                <option value="legendary">ğŸŸ¡ LegendÃ¤r</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Farbe:</label>
                            <input type="color" id="newBadgeColor" class="form-control" value="#667eea">
                        </div>
                        <div class="form-actions">
                            <button onclick="createCustomBadge()" class="btn-primary">âœ¨ Badge erstellen</button>
                        </div>
                    </div>

                    <div class="custom-badges-preview">
                        <h4>Meine erstellten Badges</h4>
                        <div id="customBadgesList" class="custom-badges-list">
                            <!-- Eigene Badges -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab: Berichte -->
            <div id="reports-tab" class="tab-content hidden">
                <div class="report-options">
                    <h3>ğŸ“ˆ Berichte generieren</h3>
                    <select id="reportClass">
                        <option value="">Klasse wÃ¤hlen...</option>
                    </select>
                    <select id="reportType">
                        <option value="overview">Ãœbersicht</option>
                        <option value="detailed">Detailliert</option>
                        <option value="progress">Fortschritt Ã¼ber Zeit</option>
                    </select>
                    <button onclick="generateReport()">Bericht erstellen</button>
                </div>
                <div id="reportContainer">
                    <!-- Berichte werden hier angezeigt -->
                </div>
            </div>

            <div class="button-group">
                <button onclick="logoutUser()" class="secondary">Abmelden</button>
            </div>
        </div>
    </div>
    
    <script type="module" src="app-firebase.js"></script>
</body>
</html>
